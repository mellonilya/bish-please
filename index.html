<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostile Work Environment Documentation Form</title>
    <!-- Link to the Web Manifest -->
    <link rel="manifest" href="/manifest.json">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF CDN for client-side PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f8fafc; /* Tailwind's gray-50 */
        }
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .form-input, .form-textarea, .form-select {
            @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm;
        }
        .form-group {
            @apply mb-6;
        }
        .file-list-item {
            @apply text-gray-800 text-sm py-1;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-3xl mx-auto bg-white p-6 sm:p-8 rounded-lg shadow-xl">
        <h1 class="text-3xl font-bold text-gray-900 mb-6 text-center">Document Hostile Work Environment Incident</h1>
        <p class="text-gray-600 mb-8 text-center">
            Use this form to meticulously record details of any incidents. Comprehensive documentation is crucial.
        </p>

        <form id="incidentForm">
            <!-- Date and Time of Incident -->
            <div class="form-group">
                <label for="incidentDateTime" class="form-label">Date and Time of Incident</label>
                <input type="datetime-local" id="incidentDateTime" name="incidentDateTime" class="form-input" required>
            </div>

            <!-- Location of Incident -->
            <div class="form-group">
                <label for="incidentLocation" class="form-label">Location of Incident</label>
                <input type="text" id="incidentLocation" name="incidentLocation" placeholder="e.g., Office break room, Remote call, Email" class="form-input" required>
            </div>

            <!-- Type of Incident -->
            <div class="form-group">
                <label for="incidentType" class="form-label">Type of Incident</label>
                <select id="incidentType" name="incidentType" class="form-select" required>
                    <option value="">Select type</option>
                    <option value="verbal">Verbal (e.g., offensive comments, yelling)</option>
                    <option value="physical">Physical (e.g., unwanted touching, intimidation)</option>
                    <option value="written">Written (e.g., notes, graffiti)</option>
                    <option value="electronic">Electronic (e.g., emails, messages, social media posts)</option>
                    <option value="visual">Visual (e.g., offensive images, gestures)</option>
                    <option value="exclusion">Exclusion/Isolation</option>
                    <option value="other">Other (please specify in description)</option>
                </select>
            </div>

            <!-- Description of Incident -->
            <div class="form-group">
                <label for="incidentDescription" class="form-label">Description of Incident</label>
                <textarea id="incidentDescription" name="incidentDescription" rows="6" placeholder="Provide a detailed, factual account of what happened, including specific words used, actions taken, and who was involved." class="form-textarea" required></textarea>
            </div>

            <!-- Individuals Involved -->
            <div class="form-group">
                <label for="perpetrator" class="form-label">Perpetrator(s) / Individuals involved in causing the hostile environment</label>
                <input type="text" id="perpetrator" name="perpetrator" placeholder="e.g., John Doe (Manager), Jane Smith (Colleague)" class="form-input" required>
            </div>

            <div class="form-group">
                <label for="witnesses" class="form-label">Witness(es) (if any)</label>
                <input type="text" id="witnesses" name="witnesses" placeholder="e.g., Alice Brown, Michael Green" class="form-input">
            </div>

            <!-- Impact on Reporter -->
            <div class="form-group">
                <label for="impact" class="form-label">Impact of Incident on You</label>
                <textarea id="impact" name="impact" rows="4" placeholder="Describe the emotional, physical, or professional impact this incident had on you. (e.g., 'Felt anxious and unable to focus for the rest of the day', 'Experienced loss of sleep', 'Feared retaliation')." class="form-textarea"></textarea>
            </div>

            <!-- Actions Taken -->
            <div class="form-group">
                <label for="actionsTaken" class="form-label">Actions Taken (by you or others, if any)</label>
                <textarea id="actionsTaken" name="actionsTaken" rows="4" placeholder="e.g., 'Reported to HR on [date]', 'Spoke to a supervisor', 'Documented in personal notes'." class="form-textarea"></textarea>
            </div>

            <!-- Supporting Evidence (Text Description) -->
            <div class="form-group">
                <label for="evidence" class="form-label">Supporting Evidence (describe existing evidence or links)</label>
                <textarea id="evidence" name="evidence" rows="4" placeholder="Describe any evidence you have (e.g., 'Screenshot of email from John Doe dated...', 'Transcript of recorded meeting', 'Log of messages from team chat'). You can also paste links if applicable." class="form-textarea"></textarea>
            </div>

            <!-- Attached Files Input -->
            <div class="form-group border-t border-gray-200 pt-6 mt-6">
                <label for="attachedFiles" class="form-label">Attach Supporting Files (Documents, Screenshots, Images)</label>
                <input type="file" id="attachedFiles" name="attachedFiles" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif" class="block w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-md file:border-0
                    file:text-sm file:font-semibold
                    file:bg-blue-50 file:text-blue-700
                    hover:file:bg-blue-100
                    transition duration-150 ease-in-out">
                <p class="text-sm text-gray-500 mt-2">
                    <span class="font-semibold text-red-600">Note:</span> Files selected here are **not embedded** into the PDF. Their names will be listed in the PDF as a record of local attachments. For actual file storage, a backend system is required.
                </p>
                <div id="fileList" class="mt-4 p-3 bg-gray-50 rounded-md border border-gray-200 min-h-[50px]">
                    <p class="text-gray-400 text-sm italic">No files selected.</p>
                </div>
            </div>

            <!-- Submit Button to save PDF -->
            <div class="flex justify-center mt-8">
                <button type="submit" id="savePdfButton" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-md shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Save as PDF
                </button>
            </div>
        </form>
    </div>

    <script>
        // Ensure jsPDF is loaded
        const { jsPDF } = window.jspdf;

        // Get elements
        const incidentForm = document.getElementById('incidentForm');
        const attachedFilesInput = document.getElementById('attachedFiles');
        const fileListDisplay = document.getElementById('fileList');

        // Event listener for file input change
        attachedFilesInput.addEventListener('change', function() {
            fileListDisplay.innerHTML = ''; // Clear previous list
            if (this.files.length > 0) {
                // Create a title for the list
                const listTitle = document.createElement('p');
                listTitle.className = 'font-semibold text-gray-700 mb-2';
                listTitle.textContent = 'Selected Files:';
                fileListDisplay.appendChild(listTitle);

                for (let i = 0; i < this.files.length; i++) {
                    const file = this.files[i];
                    const listItem = document.createElement('p');
                    listItem.className = 'file-list-item';
                    listItem.textContent = `â€¢ ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
                    fileListDisplay.appendChild(listItem);
                }
            } else {
                fileListDisplay.innerHTML = '<p class="text-gray-400 text-sm italic">No files selected.</p>';
            }
        });


        incidentForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const doc = new jsPDF();
            let y = 20; // Initial Y position for text

            // Helper function to add text and update Y position, handling line breaks
            function addText(label, value, isBold = false) {
                doc.setFont('helvetica', isBold ? 'bold' : 'normal');
                doc.setFontSize(10);
                const textLines = doc.splitTextToSize(`${label}: ${value || 'N/A'}`, 180); // Max width 180mm
                doc.text(textLines, 10, y);
                y += (textLines.length * 7) + 3; // Line height + small gap
            }

            // Add a title to the PDF
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.text('Hostile Work Environment Incident Documentation', 10, y);
            y += 15;

            // Collect and add form data to the PDF
            addText('Date and Time of Incident', document.getElementById('incidentDateTime').value);
            addText('Location of Incident', document.getElementById('incidentLocation').value);
            addText('Type of Incident', document.getElementById('incidentType').options[document.getElementById('incidentType').selectedIndex].text);
            addText('Description of Incident', document.getElementById('incidentDescription').value);
            addText('Perpetrator(s) / Individuals involved', document.getElementById('perpetrator').value);
            addText('Witness(es)', document.getElementById('witnesses').value);
            addText('Impact of Incident on You', document.getElementById('impact').value);
            addText('Actions Taken', document.getElementById('actionsTaken').value);
            addText('Supporting Evidence (Description/Links)', document.getElementById('evidence').value);

            // Add attached file names to PDF
            const attachedFiles = attachedFilesInput.files;
            if (attachedFiles.length > 0) {
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(12);
                y += 10; // Add some space
                doc.text('Attached Files (Local References Only):', 10, y);
                y += 7;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                for (let i = 0; i < attachedFiles.length; i++) {
                    doc.text(`â€¢ ${attachedFiles[i].name} (${(attachedFiles[i].size / 1024).toFixed(2)} KB)`, 15, y);
                    y += 7;
                }
                y += 5; // Add some space after the list
                const disclaimer = "Note: These files are not embedded in this PDF. They are listed here as a record of local attachments.";
                const disclaimerLines = doc.splitTextToSize(disclaimer, 180);
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(9);
                doc.text(disclaimerLines, 10, y);
                y += (disclaimerLines.length * 6) + 3;
            } else {
                 addText('Attached Files (Local References Only)', 'No files selected.');
            }


            // Save the PDF with a dynamic filename
            const incidentDate = document.getElementById('incidentDateTime').value.split('T')[0] || 'UnknownDate';
            doc.save(`Hostile_Work_Environment_Incident_${incidentDate}.pdf`);
        });
    </script>
    <script>
        // Register the Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>